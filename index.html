<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Limit geocoder results to a named region</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #map {
        width: 100%;
        flex-grow: 1;
        height: 100%;
      }
      #container {
        display: flex;
        height: 100%;
      }
      #sidebar {
        width: 300px;
        flex-shrink: 0;
        height: 100%;
        padding: 30px;
      }
      button {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="sidebar">
        <button id="fly-to-coney">Fly to Coney Island</button><br />
        <button id="fit-to-queens">Fit to Queens</button><br />
        <button id="reset-view">Reset</button>
      </div>
      <div id="map"></div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
      type="text/css"
    />
    <div id="map"></div>
    <script>
      const INITIAL_CENTER = [-73.935242, 40.73061];
      const INITIAL_ZOOM = 9;
      // TO MAKE THE MAP APPEAR YOU MUST
      // ADD YOUR ACCESS TOKEN FROM
      // https://account.mapbox.com
      mapboxgl.accessToken =
        'pk.eyJ1IjoicnV0dmlwIiwiYSI6ImNsYm9saTdvMjA5aGUzbmxjb2EwM3oybngifQ.jPNFOWD_1ExOl4DAUP7Rlw';
      const map = new mapboxgl.Map({
        container: 'map', // It'll find the div with id 'map' on the page
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/mapbox/dark-v11',
        center: INITIAL_CENTER,
        zoom: INITIAL_ZOOM,
        projection: 'globe',
      });
      const boroughs = [
        {
          name: 'Brooklyn',
          color: '#329645',
          lngLat: [-73.968815, 40.641509],
        },
        {
          name: 'Manhattan',
          color: '#995092',
          lngLat: [-73.98513, 40.758896],
        },
        {
          name: 'Queens',
          color: '#b37b54',
          lngLat: [-73.883072, 40.755684],
        },
        {
          name: 'Staten Island',
          color: '#423dba',
          lngLat: [-74.182712, 40.555548],
        },
        {
          name: 'The Bronx',
          color: '#dbcf63',
          lngLat: [-73.880341, 40.861706],
        },
      ];
      boroughs.forEach(({ name, color, lngLat }) => {
        console.log('loop');
        const popup = new mapboxgl.Popup({ offset: 25 }).setText(name);
        const marker1 = new mapboxgl.Marker({
          color,
          scale: 0.6,
        })
          .setLngLat(lngLat)
          .setPopup(popup)
          .addTo(map);
      });

      map.on('load', () => {
        map.setFog({});
        map.addSource('borough-boundaries', {
          type: 'geojson',
          data: 'data/borough-boundaries.geojson',
        });
        map.addLayer({
          id: 'borough-boundaries-fill',
          type: 'fill',
          source: 'borough-boundaries',
          paint: {
            'fill-color': [
              'match',
              ['get', 'boro_code'],
              1,
              'green',
              2,
              'purple',
              3,
              'orange',
              4,
              'yellow',
              5,
              'pink',
              'steelblue',
            ],
            'fill-opacity': [
              'case',
              ['boolean', ['feature-state', 'hoven'], false],
              1,
              0.5,
            ],
          },
        });
        map.addLayer({
          id: 'borough-boundaries-line',
          type: 'line',
          source: 'borough-boundaries',
          paint: {
            'line-color': 'white',
            'line-width': 4,
            'line-opacity': 0.7,
          },
        });
      });
      map.on('click', (e) => {
        console.log('click', e.point);
        const [selectedBorough] = map.queryRenderedFeatures(e.point, {
          layers: ['borough-boundaries-fill'],
        });
        if (selectedBorough) {
          const { boro_name, pop2020 } = selectedBorough.properties;
          alert(`The population of ${boro_name} is ${pop2020}`);
        }
      });
      // fly to coney island
      document.querySelector('#fly-to-coney').addEventListener('click', () => {
        map.flyTo({
          center: [-73.98587, 40.572506],
          zoom: 15,
          pitch: 45,
        });
      });
      // reset map view
      document.querySelector('#reset-view').addEventListener('click', () => {
        map.flyTo({
          center: INITIAL_CENTER,
          zoom: INITIAL_ZOOM,
          pitch: 0,
        });
      });
      // reset map view
      document.querySelector('#fit-to-queens').addEventListener('click', () => {
        map.fitBounds([
          [-73.931334, 40.641147], // southwestern corner of the bounds
          [-73.806980, 40.803824], // northestern corner of the bounds
        ]);
      });
    </script>
  </body>
</html>
