<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Limit geocoder results to a named region</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
      type="text/css"
    />
    <div id="map"></div>
    <script>
      // TO MAKE THE MAP APPEAR YOU MUST
      // ADD YOUR ACCESS TOKEN FROM
      // https://account.mapbox.com
      mapboxgl.accessToken =
        'pk.eyJ1IjoicnV0dmlwIiwiYSI6ImNsYm9saTdvMjA5aGUzbmxjb2EwM3oybngifQ.jPNFOWD_1ExOl4DAUP7Rlw';
      const map = new mapboxgl.Map({
        container: 'map', // It'll find the div with id 'map' on the page
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-73.935242, 40.73061],
        zoom: 11,
        projection: 'globe',
      });
      const boroughs = [
        {
          name: 'Brooklyn',
          color: '#329645',
          lngLat: [-73.968815, 40.641509],
        },
        {
          name: 'Manhattan',
          color: '#995092',
          lngLat: [-73.98513, 40.758896],
        },
        {
          name: 'Queens',
          color: '#b37b54',
          lngLat: [-73.883072, 40.755684],
        },
        {
          name: 'Staten Island',
          color: '#423dba',
          lngLat: [-74.182712, 40.555548],
        },
        {
          name: 'The Bronx',
          color: '#dbcf63',
          lngLat: [-73.880341, 40.861706],
        },
      ];
      boroughs.forEach(({ name, color, lngLat }) => {
        console.log('loop');
        const popup = new mapboxgl.Popup({ offset: 25 }).setText(name);
        const marker1 = new mapboxgl.Marker({
          color,
          scale: 0.6,
        })
          .setLngLat(lngLat)
          .setPopup(popup)
          .addTo(map);
      });

      map.on('load', () => {
        map.setFog({});
        map.addSource('borough-boundaries', {
          type: 'geojson',
          data: 'data/borough-boundaries.geojson',
        });
        map.addLayer({
          id: 'borough-boundaries-fill',
          type: 'fill',
          source: 'borough-boundaries',
          paint: {
            'fill-color': [
              'match',
              ['get', 'boro_code'],
              1,
              'green',
              2,
              'purple',
              3,
              'orange',
              4,
              'yellow',
              5,
              'pink',
              'steelblue',
            ],
          },
        });
        map.addLayer({
          id: 'borough-boundaries-line',
          type: 'line',
          source: 'borough-boundaries',
          paint: {
            'line-color': 'white',
            'line-width': 4,
            'line-opacity': 0.7,
          },
        });
      });
      map.on('click', (e) => {
        console.log('click', e.point);
        const [selectedBorough] = map.queryRenderedFeatures(e.point, {
          layers: ['borough-boundaries-fill'],
        });
        if (selectedBorough) {
          const { boro_name, pop2020 } = selectedBorough.properties;
          alert(`The population of ${boro_name} is ${pop2020}`);
        }
      });
    </script>
  </body>
</html>
